'Probe Script'Use at own riskSub MainCode "G21"'This code is added for testing only, incase script is abortedCode "G90" 		'I don't think this is needed anyway because it is in the probe scriptMessage("Probing...")Sleep(1500)'Code "G4 P1"ProbeZEnd SubSub ProbeZ()If GetOEMDRO(1823) < .6 Then	MsgBox("Increase search depth to atleast .600in")	Code "G90"	Sleep(200)	Code "G20"	Exit SubEnd If'chengdu xhc tec. probe z surface macro 'Code "G4 P1"'Code "G21"FeedCurrent = GetOemDRO(818) 	'Get the current settings, OEM DROs (818)=Feedrate DROZCurrent = GetOemDro(802)	'OEM DROs (802)=Z DROGageH = GetOEMDRO(1828)*25.4 	'25	'OEMDRO(1001)=Gage Block HeightSearchDist = GetOEMDRO(1823)*25.4ZNew = ZCurrent - SearchDist	'probe down base off search distanceCode "G90F200"			'slow feed rate to 100 MM/MINSetOemDRO(818,200) Rem Code "G4 P1"		'Pause 1 second to give time to position probe plateCode "G31F100 Z" &ZNewWhile IsMoving()Sleep(10)Wend'Call SetDro (2,GageH)		'DRO(2)=Z DROSleep(350)FirstMeasureZ = GetOEMDRO(802)			'Store first measurement to compare later'New code to check if probe hit hereIf Abs(Abs(ZNew)-Abs(FirstMeasureZ)) < .5 Then	Message("Failed to find Probe")	MsgBox("Probe not reached after traveling " & SearchDist/25.4 & "in. Please rerun with probe closer.")	Code "G90"	Sleep(200)	Code "F" &FeedCurrent  		'restore starting feed rate    	SetOemDRO(818,FeedCurrent)	Code "G20"	Exit SubEnd IfMessage(SearchDist & ZNew & FirstMeasureZ)Sleep(1000)Code "G91F100"SetOemDRO(818,100)						'Incremental mode and reduce probe speedSleep(200)Message("2nd Touch")Rem Code "G4 P1"		'Pause 1 second to give time to position probe plateRepeatTouch = 3						'Retract height before touching 2nd timeRepeatSearch = -RepeatTouch - 1Code "G0 Z" &RepeatTouchCode "G31F50 Z" &RepeatSearchWhile IsMoving()Sleep(10)WendSecondMeasureZ = GetOEMDRO(802)Message("1st measure: " & FirstMeasureZ & " and 2nd measure: " &SecondMeasureZ)Sleep(1000)		'For testing so can see valuesIf Abs(FirstMeasureZ - SecondMeasureZ) < .254 Then			'this is 0.010" tolerance	Call SetDro(2,GageH)	Sleep(200)	Code "G90"	Sleep(200)	'End of new code block	FinalMove = GageH + 6.35	Code  "G0 Z" &FinalMove	Code "F" &FeedCurrent  		'restore starting feed rate    	SetOemDRO(818,FeedCurrent)	Message("Probe Succesful")Else 	Code "G0 Z12.7"	Code "G90"	Sleep(200)	Code "F" &FeedCurrent  		'restore starting feed rate    	SetOemDRO(818,FeedCurrent)	MsgBox("Probe out of tolerance, try again!")End IfCode "G20"End Sub  